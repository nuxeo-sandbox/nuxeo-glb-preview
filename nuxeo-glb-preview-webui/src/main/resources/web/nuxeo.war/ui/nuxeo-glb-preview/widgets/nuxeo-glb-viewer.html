<!-- Import the component -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<!--
`nuxeo-glb-viewer`
@group Nuxeo UI
@element nuxeo-glb-viewer
-->
<dom-module id="nuxeo-glb-viewer">
    <template>
        <style include="nuxeo-styles">
            :host {
                display: block;
                width: 100%;
                height: 100%;
            }

            model-viewer {
                width: 100%;
                height: 100%;
            }
        </style>

        <model-viewer src="[[_getSource(document,sourceUrl)]]" poster="[[_getThumbnail(document)]]"
                      alt="[[document.title]]" ar ar-modes="webxr scene-viewer quick-look"
                      environment-image="neutral" shadow-intensity="0" shadow-softness="0" exposure="0.92" auto-rotate
                      camera-controls>
        </model-viewer>

    </template>

    <script>
        Polymer({
            is: 'nuxeo-glb-viewer',
            behaviors: [Nuxeo.LayoutBehavior],
            properties: {
                document: {
                    type: Object
                },

                sourceUrl: {
                    type: String
                },

                thumbnailUrl: {
                    type: String
                }
            },

            _getSource: function (document, sourceUrl) {
                if (sourceUrl) {
                    return sourceUrl
                } else if (document) {
                    if (document.facets.includes('GLB')) {
                        let renditions = document.properties['glb:renditions'];
                        if (renditions.length > 0) {
                            return renditions[0].content.data;
                        } else {
                            return document.properties['file:content'] && document.properties['file:content'].data;
                        }
                    } else {
                        return undefined;
                    }
                } else {
                    return undefined;
                }
            },

            _getThumbnail: function (document, thumbnailUrl) {
                if (thumbnailUrl) {
                    return thumbnailUrl
                } else if (document) {
                    return document.contextParameters.thumbnail.url;
                } else {
                    return undefined;
                }
            }

        });
    </script>
</dom-module>
